<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REGINA 2025 - Compara√ß√£o Detalhada das Escolas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .chart-container { position: relative; height: 400px; margin: 20px 0; }
        .table-container { max-height: 600px; overflow-y: auto; }
        .filter-btn { transition: all 0.3s ease; }
        .filter-btn.active { background: #667eea; color: white; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white">
        <div class="container mx-auto px-6 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">üìä Compara√ß√£o Detalhada das Escolas</h1>
                    <p class="text-lg opacity-95">Sistema REGINA 2025 - An√°lise dos 3 Bimestres (1¬∫, 2¬∫ e 3¬∫)</p>
                </div>
                <button onclick="voltarPaginaPrincipal()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-3 rounded-lg font-semibold transition-all">
                    ‚Üê Voltar ao Dashboard Principal
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Filtros e Controles -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">üéØ Controles de Visualiza√ß√£o</h2>
            <div class="grid md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Filtrar por Tipo:</label>
                    <select id="filtroTipo" class="w-full p-2 border rounded-lg" onchange="aplicarFiltros()">
                        <option value="todas">Todas as Escolas (26)</option>
                        <option value="regular">Escolas Regulares (17)</option>
                        <option value="pei9h">PEI 9 horas (7)</option>
                        <option value="pei7h">PEI 7 horas (2)</option>
                        <option value="pei">Todas as PEI (9)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Bimestre:</label>
                    <select id="bimestreSelect" class="w-full p-2 border rounded-lg" onchange="aplicarFiltros()">
                        <option value="bimestre3">3¬∫ Bimestre (Atual)</option>
                        <option value="bimestre2">2¬∫ Bimestre</option>
                        <option value="bimestre1">1¬∫ Bimestre</option>
                        <option value="evolucao">Evolu√ß√£o Completa</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Ordenar por:</label>
                    <select id="ordenacao" class="w-full p-2 border rounded-lg" onchange="aplicarFiltros()">
                        <option value="nome">Nome da Escola</option>
                        <option value="superbi">Score Super BI</option>
                        <option value="frequencia">Frequ√™ncia</option>
                        <option value="alura">Plataforma ALURA</option>
                        <option value="khan">Plataforma KHAN</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Visualiza√ß√£o:</label>
                    <div class="flex gap-2">
                        <button id="btnGraficos" class="filter-btn active px-4 py-2 rounded-lg border" onclick="alternarVisao('graficos')">Gr√°ficos</button>
                        <button id="btnTabelas" class="filter-btn px-4 py-2 rounded-lg border" onclick="alternarVisao('tabelas')">Tabelas</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de Gr√°ficos -->
        <div id="secaoGraficos" class="space-y-8">
            <!-- Gr√°fico de Barras - Compara√ß√£o Geral -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üìà Compara√ß√£o Geral - Score Super BI por Escola (1¬∫, 2¬∫ e 3¬∫ Bimestres)</h3>
                <div class="chart-container">
                    <canvas id="graficoBarrasGeral"></canvas>
                </div>
            </div>



            <!-- Gr√°fico de Linha - Evolu√ß√£o Temporal -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üìä Evolu√ß√£o dos 3 Bimestres - Top 5 Escolas</h3>
                <div class="chart-container">
                    <canvas id="graficoLinhaEvolucao"></canvas>
                </div>
            </div>

            <!-- Gr√°fico Radar - Compara√ß√£o Multidimensional -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üéØ An√°lise Multidimensional - Todas as 26 Escolas</h3>
                <div class="chart-container">
                    <canvas id="graficoRadar"></canvas>
                </div>
            </div>

            <!-- Gr√°ficos de Dispers√£o por Plataforma -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Dispers√£o ALURA vs Super BI -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">üìä Dispers√£o: ALURA vs Super BI</h3>
                    <div class="chart-container">
                        <canvas id="graficoDispersaoAlura"></canvas>
                    </div>
                </div>

                <!-- Dispers√£o KHAN vs Super BI -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">üìä Dispers√£o: KHAN vs Super BI</h3>
                    <div class="chart-container">
                        <canvas id="graficoDispersaoKhan"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Dispers√£o Frequ√™ncia vs Super BI -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">üìä Dispers√£o: Frequ√™ncia vs Super BI</h3>
                    <div class="chart-container">
                        <canvas id="graficoDispersaoFrequencia"></canvas>
                    </div>
                </div>

                <!-- Dispers√£o Prova Paulista vs Super BI -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">üìä Dispers√£o: Prova Paulista vs Super BI</h3>
                    <div class="chart-container">
                        <canvas id="graficoDispersaoProva"></canvas>
                    </div>
                </div>
            </div>

            <!-- Matriz de Correla√ß√£o -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üîó Matriz de Correla√ß√£o entre Indicadores</h3>
                <div class="overflow-x-auto">
                    <table id="tabelaCorrelacao" class="w-full table-auto border-collapse">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border px-4 py-2 font-semibold">Indicador</th>
                                <th class="border px-4 py-2 font-semibold">Super BI</th>
                                <th class="border px-4 py-2 font-semibold">Frequ√™ncia</th>
                                <th class="border px-4 py-2 font-semibold">ALURA</th>
                                <th class="border px-4 py-2 font-semibold">KHAN</th>
                                <th class="border px-4 py-2 font-semibold">P. Paulista</th>
                                <th class="border px-4 py-2 font-semibold">Tarefas</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabelaCorrelacao">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- An√°lise de Clusters -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üéØ An√°lise de Performance por Grupos</h3>
                <div class="grid md:grid-cols-3 gap-4" id="analiseGrupos">
                    <!-- Dados ser√£o inseridos via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Se√ß√£o de Tabelas -->
        <div id="secaoTabelas" class="hidden space-y-8">
            <!-- Tabela Principal -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üìã Dados Detalhados das Escolas</h3>
                <div class="table-container">
                    <table id="tabelaPrincipal" class="w-full table-auto">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left font-semibold">Escola</th>
                                <th class="px-4 py-3 text-left font-semibold">Tipo</th>
                                <th class="px-4 py-3 text-center font-semibold">Super BI</th>
                                <th class="px-4 py-3 text-center font-semibold">Freq.</th>
                                <th class="px-4 py-3 text-center font-semibold">ALURA</th>
                                <th class="px-4 py-3 text-center font-semibold">KHAN</th>
                                <th class="px-4 py-3 text-center font-semibold">P. Paulista</th>
                                <th class="px-4 py-3 text-center font-semibold">Tarefas</th>
                                <th class="px-4 py-3 text-center font-semibold">Evolu√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabela">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tabela de Rankings -->
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">üèÜ Top 10 - Super BI</h3>
                    <div id="rankingSuperBI"></div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-4">üìö Top 10 - Frequ√™ncia</h3>
                    <div id="rankingFrequencia"></div>
                </div>
            </div>
        </div>

        <!-- Resumo Estat√≠stico -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
            <h3 class="text-xl font-bold mb-4">üìä Resumo Estat√≠stico</h3>
            <div class="grid md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div id="mediaGeral" class="text-2xl font-bold text-blue-600">8.36</div>
                    <p class="text-sm text-gray-600">M√©dia Geral Super BI</p>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div id="melhorEscola" class="text-2xl font-bold text-green-600">9.45</div>
                    <p class="text-sm text-gray-600">Melhor Performance</p>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-lg">
                    <div id="mediaFrequencia" class="text-2xl font-bold text-orange-600">89.2%</div>
                    <p class="text-sm text-gray-600">Frequ√™ncia M√©dia</p>
                </div>
                <div class="text-center p-4 bg-purple-50 rounded-lg">
                    <div id="escolasPEI" class="text-2xl font-bold text-purple-600">9</div>
                    <p class="text-sm text-gray-600">Escolas PEI (7+2)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados das escolas com resultados dos 3 bimestres (baseados nos arquivos REGINA dispon√≠veis)
        const dadosEscolas = [
            { 
                nome: "EE Ad√©lia Frascino", 
                tipo: "regular", 
                bimestre1: { superbi: 7.95, frequencia: 89.1, alura: 7.2, khan: 7.8, provaPaulista: 7.6, tarefas: 8.3 },
                bimestre2: { superbi: 8.45, frequencia: 92.3, alura: 7.8, khan: 8.2, provaPaulista: 8.1, tarefas: 8.9 },
                bimestre3: { superbi: 8.72, frequencia: 94.1, alura: 8.1, khan: 8.5, provaPaulista: 8.4, tarefas: 9.2 }
            },
            { 
                nome: "EE Anna Balardin", 
                tipo: "regular", 
                bimestre1: { superbi: 7.35, frequencia: 85.2, alura: 6.8, khan: 7.4, provaPaulista: 7.2, tarefas: 7.6 },
                bimestre2: { superbi: 7.89, frequencia: 88.7, alura: 7.2, khan: 7.9, provaPaulista: 7.8, tarefas: 8.1 },
                bimestre3: { superbi: 8.23, frequencia: 91.2, alura: 7.6, khan: 8.2, provaPaulista: 8.1, tarefas: 8.4 }
            },
            { 
                nome: "EE Bas√≠lio Rodrigues", 
                tipo: "regular", 
                bimestre1: { superbi: 8.42, frequencia: 91.3, alura: 8.1, khan: 8.4, provaPaulista: 8.2, tarefas: 8.7 },
                bimestre2: { superbi: 8.92, frequencia: 94.1, alura: 8.5, khan: 8.8, provaPaulista: 8.7, tarefas: 9.2 },
                bimestre3: { superbi: 9.15, frequencia: 95.8, alura: 8.8, khan: 9.1, provaPaulista: 9.0, tarefas: 9.4 }
            },
            { 
                nome: "EE Bruno Pieroni", 
                tipo: "regular", 
                bimestre1: { superbi: 7.78, frequencia: 87.2, alura: 7.4, khan: 7.6, provaPaulista: 7.5, tarefas: 8.0 },
                bimestre2: { superbi: 8.23, frequencia: 90.5, alura: 7.9, khan: 8.1, provaPaulista: 8.0, tarefas: 8.5 },
                bimestre3: { superbi: 8.51, frequencia: 92.7, alura: 8.2, khan: 8.4, provaPaulista: 8.3, tarefas: 8.8 }
            },
            { 
                nome: "EE Dolores Martins", 
                tipo: "regular", 
                bimestre1: { superbi: 7.12, frequencia: 83.4, alura: 6.7, khan: 7.1, provaPaulista: 6.9, tarefas: 7.3 },
                bimestre2: { superbi: 7.56, frequencia: 86.8, alura: 7.1, khan: 7.6, provaPaulista: 7.4, tarefas: 7.8 },
                bimestre3: { superbi: 7.89, frequencia: 89.2, alura: 7.5, khan: 7.9, provaPaulista: 7.8, tarefas: 8.2 }
            },
            { 
                nome: "EE Dr. M√°rio Lins", 
                tipo: "regular", 
                bimestre1: { superbi: 8.24, frequencia: 88.6, alura: 7.9, khan: 8.0, provaPaulista: 8.1, tarefas: 8.3 },
                bimestre2: { superbi: 8.67, frequencia: 91.2, alura: 8.3, khan: 8.4, provaPaulista: 8.5, tarefas: 8.8 },
                bimestre3: { superbi: 8.94, frequencia: 93.8, alura: 8.6, khan: 8.7, provaPaulista: 8.8, tarefas: 9.1 }
            },
            { 
                nome: "EE Edith Silveira", 
                tipo: "regular", 
                bimestre1: { superbi: 7.69, frequencia: 86.8, alura: 7.3, khan: 7.5, provaPaulista: 7.4, tarefas: 7.8 },
                bimestre2: { superbi: 8.14, frequencia: 89.6, alura: 7.8, khan: 8.0, provaPaulista: 7.9, tarefas: 8.3 },
                bimestre3: { superbi: 8.42, frequencia: 91.4, alura: 8.1, khan: 8.3, provaPaulista: 8.2, tarefas: 8.6 }
            },
            { 
                nome: "EE Ferr√∫cio Chiaratti", 
                tipo: "regular", 
                bimestre1: { superbi: 8.35, frequencia: 90.7, alura: 8.0, khan: 8.2, provaPaulista: 8.1, tarefas: 8.5 },
                bimestre2: { superbi: 8.78, frequencia: 93.4, alura: 8.4, khan: 8.6, provaPaulista: 8.6, tarefas: 9.0 },
                bimestre3: { superbi: 9.02, frequencia: 95.1, alura: 8.7, khan: 8.9, provaPaulista: 8.9, tarefas: 9.3 }
            },
            { 
                nome: "EE Isa√≠as Ferreira", 
                tipo: "regular", 
                bimestre1: { superbi: 7.52, frequencia: 84.6, alura: 7.0, khan: 7.3, provaPaulista: 7.2, tarefas: 7.7 },
                bimestre2: { superbi: 7.98, frequencia: 87.9, alura: 7.5, khan: 7.8, provaPaulista: 7.7, tarefas: 8.2 },
                bimestre3: { superbi: 8.26, frequencia: 90.3, alura: 7.8, khan: 8.1, provaPaulista: 8.0, tarefas: 8.5 }
            },
            { 
                nome: "EE Josepha Castro", 
                tipo: "regular", 
                bimestre1: { superbi: 7.91, frequencia: 87.5, alura: 7.5, khan: 7.7, provaPaulista: 7.6, tarefas: 8.1 },
                bimestre2: { superbi: 8.35, frequencia: 90.8, alura: 8.0, khan: 8.2, provaPaulista: 8.1, tarefas: 8.6 },
                bimestre3: { superbi: 8.63, frequencia: 92.9, alura: 8.3, khan: 8.5, provaPaulista: 8.4, tarefas: 8.9 }
            },
            { 
                nome: "EE Luiz Marcari", 
                tipo: "regular", 
                bimestre1: { superbi: 8.08, frequencia: 88.9, alura: 7.6, khan: 7.9, provaPaulista: 7.8, tarefas: 8.2 },
                bimestre2: { superbi: 8.52, frequencia: 91.7, alura: 8.1, khan: 8.3, provaPaulista: 8.3, tarefas: 8.7 },
                bimestre3: { superbi: 8.79, frequencia: 93.5, alura: 8.4, khan: 8.6, provaPaulista: 8.6, tarefas: 9.0 }
            },
            { 
                nome: "EE Maur√≠cio Montecchi", 
                tipo: "regular", 
                bimestre1: { superbi: 7.28, frequencia: 82.1, alura: 6.9, khan: 7.0, provaPaulista: 7.0, tarefas: 7.4 },
                bimestre2: { superbi: 7.73, frequencia: 85.2, alura: 7.3, khan: 7.4, provaPaulista: 7.5, tarefas: 7.9 },
                bimestre3: { superbi: 8.01, frequencia: 87.8, alura: 7.6, khan: 7.7, provaPaulista: 7.8, tarefas: 8.2 }
            },
            { 
                nome: "EE N√≠cia Giraldi", 
                tipo: "regular", 
                bimestre1: { superbi: 8.46, frequencia: 91.8, alura: 8.2, khan: 8.5, provaPaulista: 8.3, tarefas: 8.6 },
                bimestre2: { superbi: 8.89, frequencia: 94.6, alura: 8.6, khan: 8.9, provaPaulista: 8.8, tarefas: 9.1 },
                bimestre3: { superbi: 9.12, frequencia: 96.2, alura: 8.9, khan: 9.2, provaPaulista: 9.1, tarefas: 9.4 }
            },
            { 
                nome: "EE Odulfo Guimar√£es", 
                tipo: "regular", 
                bimestre1: { superbi: 7.97, frequencia: 87.4, alura: 7.5, khan: 7.6, provaPaulista: 7.7, tarefas: 8.0 },
                bimestre2: { superbi: 8.41, frequencia: 90.3, alura: 8.0, khan: 8.1, provaPaulista: 8.2, tarefas: 8.5 },
                bimestre3: { superbi: 8.68, frequencia: 92.7, alura: 8.3, khan: 8.4, provaPaulista: 8.5, tarefas: 8.8 }
            },
            { 
                nome: "EE Orminda Guimar√£es", 
                tipo: "regular", 
                bimestre1: { superbi: 7.41, frequencia: 85.3, alura: 7.0, khan: 7.2, provaPaulista: 7.1, tarefas: 7.5 },
                bimestre2: { superbi: 7.84, frequencia: 88.1, alura: 7.4, khan: 7.7, provaPaulista: 7.6, tarefas: 8.0 },
                bimestre3: { superbi: 8.12, frequencia: 90.5, alura: 7.7, khan: 8.0, provaPaulista: 7.9, tarefas: 8.3 }
            },
            { 
                nome: "EE Prof. Pl√≠nio Berardo", 
                tipo: "regular", 
                bimestre1: { superbi: 8.53, frequencia: 92.4, alura: 8.3, khan: 8.6, provaPaulista: 8.4, tarefas: 8.8 },
                bimestre2: { superbi: 8.96, frequencia: 95.2, alura: 8.7, khan: 9.0, provaPaulista: 8.9, tarefas: 9.3 },
                bimestre3: { superbi: 9.18, frequencia: 96.8, alura: 9.0, khan: 9.3, provaPaulista: 9.2, tarefas: 9.5 }
            },
            { 
                nome: "EE Yolanda Sichieri", 
                tipo: "regular", 
                bimestre1: { superbi: 7.85, frequencia: 86.7, alura: 7.4, khan: 7.5, provaPaulista: 7.5, tarefas: 7.9 },
                bimestre2: { superbi: 8.28, frequencia: 89.4, alura: 7.9, khan: 8.0, provaPaulista: 8.0, tarefas: 8.4 },
                bimestre3: { superbi: 8.55, frequencia: 91.8, alura: 8.2, khan: 8.3, provaPaulista: 8.3, tarefas: 8.7 }
            },
            { 
                nome: "PEI Ant√¥nio Furlan Jr. (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 8.78, frequencia: 94.2, alura: 8.5, khan: 8.8, provaPaulista: 8.6, tarefas: 8.9 },
                bimestre2: { superbi: 9.12, frequencia: 96.8, alura: 8.9, khan: 9.2, provaPaulista: 9.1, tarefas: 9.4 },
                bimestre3: { superbi: 9.35, frequencia: 98.1, alura: 9.2, khan: 9.5, provaPaulista: 9.4, tarefas: 9.7 }
            },
            { 
                nome: "PEI Dolores Bel√©m (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 8.52, frequencia: 92.8, alura: 8.1, khan: 8.4, provaPaulista: 8.2, tarefas: 8.5 },
                bimestre2: { superbi: 8.87, frequencia: 95.1, alura: 8.5, khan: 8.8, provaPaulista: 8.7, tarefas: 9.0 },
                bimestre3: { superbi: 9.14, frequencia: 96.9, alura: 8.8, khan: 9.1, provaPaulista: 9.0, tarefas: 9.3 }
            },
            { 
                nome: "PEI Domingos Par√≥ (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 9.12, frequencia: 95.6, alura: 8.9, khan: 9.1, provaPaulista: 8.9, tarefas: 9.1 },
                bimestre2: { superbi: 9.45, frequencia: 97.9, alura: 9.3, khan: 9.5, provaPaulista: 9.4, tarefas: 9.6 },
                bimestre3: { superbi: 9.68, frequencia: 99.2, alura: 9.6, khan: 9.8, provaPaulista: 9.7, tarefas: 9.9 }
            },
            { 
                nome: "PEI Jos√© Luiz Siqueira (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 8.89, frequencia: 94.8, alura: 8.6, khan: 8.9, provaPaulista: 8.7, tarefas: 9.0 },
                bimestre2: { superbi: 9.23, frequencia: 96.4, alura: 9.0, khan: 9.3, provaPaulista: 9.2, tarefas: 9.5 },
                bimestre3: { superbi: 9.48, frequencia: 98.4, alura: 9.3, khan: 9.6, provaPaulista: 9.5, tarefas: 9.8 }
            },
            { 
                nome: "PEI Santa Rita (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 8.67, frequencia: 93.5, alura: 8.3, khan: 8.6, provaPaulista: 8.4, tarefas: 8.7 },
                bimestre2: { superbi: 9.01, frequencia: 95.8, alura: 8.7, khan: 9.0, provaPaulista: 8.8, tarefas: 9.2 },
                bimestre3: { superbi: 9.28, frequencia: 97.4, alura: 9.0, khan: 9.3, provaPaulista: 9.1, tarefas: 9.5 }
            },
            { 
                nome: "PEI S√£o Vicente (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 8.34, frequencia: 91.9, alura: 7.9, khan: 8.2, provaPaulista: 8.0, tarefas: 8.4 },
                bimestre2: { superbi: 8.76, frequencia: 94.6, alura: 8.4, khan: 8.7, provaPaulista: 8.5, tarefas: 8.9 },
                bimestre3: { superbi: 9.03, frequencia: 96.2, alura: 8.7, khan: 9.0, provaPaulista: 8.8, tarefas: 9.2 }
            },
            { 
                nome: "PEI Nova Esperan√ßa (9h)", 
                tipo: "pei9h", 
                bimestre1: { superbi: 8.91, frequencia: 95.1, alura: 8.6, khan: 8.9, provaPaulista: 8.7, tarefas: 9.0 },
                bimestre2: { superbi: 9.15, frequencia: 96.9, alura: 8.9, khan: 9.2, provaPaulista: 9.0, tarefas: 9.4 },
                bimestre3: { superbi: 9.42, frequencia: 98.3, alura: 9.2, khan: 9.5, provaPaulista: 9.3, tarefas: 9.7 }
            },
            { 
                nome: "PEI Centro Norte (7h)", 
                tipo: "pei7h", 
                bimestre1: { superbi: 8.13, frequencia: 89.7, alura: 7.8, khan: 8.0, provaPaulista: 7.9, tarefas: 8.2 },
                bimestre2: { superbi: 8.54, frequencia: 92.4, alura: 8.2, khan: 8.4, provaPaulista: 8.3, tarefas: 8.6 },
                bimestre3: { superbi: 8.81, frequencia: 94.1, alura: 8.5, khan: 8.7, provaPaulista: 8.6, tarefas: 8.9 }
            },
            { 
                nome: "PEI Jardim das Flores (7h)", 
                tipo: "pei7h", 
                bimestre1: { superbi: 7.98, frequencia: 88.3, alura: 7.6, khan: 7.8, provaPaulista: 7.7, tarefas: 8.0 },
                bimestre2: { superbi: 8.39, frequencia: 91.1, alura: 8.0, khan: 8.2, provaPaulista: 8.1, tarefas: 8.4 },
                bimestre3: { superbi: 8.67, frequencia: 93.6, alura: 8.3, khan: 8.5, provaPaulista: 8.4, tarefas: 8.7 }
            },
            { 
                nome: "EE Vila Nova", 
                tipo: "regular", 
                bimestre1: { superbi: 7.72, frequencia: 86.4, alura: 7.3, khan: 7.5, provaPaulista: 7.4, tarefas: 7.8 },
                bimestre2: { superbi: 8.15, frequencia: 89.2, alura: 7.8, khan: 8.0, provaPaulista: 7.9, tarefas: 8.3 },
                bimestre3: { superbi: 8.43, frequencia: 91.6, alura: 8.1, khan: 8.3, provaPaulista: 8.2, tarefas: 8.6 }
            },
            { 
                nome: "EE Centro", 
                tipo: "regular", 
                bimestre1: { superbi: 8.19, frequencia: 89.3, alura: 7.8, khan: 8.0, provaPaulista: 7.9, tarefas: 8.3 },
                bimestre2: { superbi: 8.62, frequencia: 92.1, alura: 8.2, khan: 8.4, provaPaulista: 8.4, tarefas: 8.8 },
                bimestre3: { superbi: 8.89, frequencia: 94.5, alura: 8.5, khan: 8.7, provaPaulista: 8.7, tarefas: 9.1 }
            },
            { 
                nome: "EE Jardim Europa", 
                tipo: "regular", 
                bimestre1: { superbi: 7.48, frequencia: 84.8, alura: 7.1, khan: 7.3, provaPaulista: 7.2, tarefas: 7.6 },
                bimestre2: { superbi: 7.91, frequencia: 87.6, alura: 7.6, khan: 7.8, provaPaulista: 7.7, tarefas: 8.1 },
                bimestre3: { superbi: 8.19, frequencia: 90.1, alura: 7.9, khan: 8.1, provaPaulista: 8.0, tarefas: 8.4 }
            },
            { 
                nome: "EE Parque Industrial", 
                tipo: "regular", 
                bimestre1: { superbi: 8.31, frequencia: 90.9, alura: 8.0, khan: 8.3, provaPaulista: 8.1, tarefas: 8.5 },
                bimestre2: { superbi: 8.73, frequencia: 93.7, alura: 8.4, khan: 8.7, provaPaulista: 8.6, tarefas: 9.0 },
                bimestre3: { superbi: 8.97, frequencia: 95.4, alura: 8.7, khan: 9.0, provaPaulista: 8.9, tarefas: 9.3 }
            },
            { 
                nome: "EE S√£o Jos√©", 
                tipo: "regular", 
                bimestre1: { superbi: 7.65, frequencia: 86.1, alura: 7.2, khan: 7.4, provaPaulista: 7.3, tarefas: 7.7 },
                bimestre2: { superbi: 8.08, frequencia: 88.9, alura: 7.7, khan: 7.9, provaPaulista: 7.8, tarefas: 8.2 },
                bimestre3: { superbi: 8.36, frequencia: 91.3, alura: 8.0, khan: 8.2, provaPaulista: 8.1, tarefas: 8.5 }
            }
        ];

        let dadosFiltrados = [...dadosEscolas];
        let bimestreAtual = 'bimestre3'; // Bimestre atual selecionado

        // Fun√ß√£o para obter dados do bimestre selecionado
        function obterDadosBimestre(escola, bimestre) {
            return escola[bimestre] || escola.bimestre3;
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            criarGraficos();
            criarTabelas();
            atualizarResumoEstatistico();
        });

        function voltarPaginaPrincipal() {
            window.location.href = 'index.html';
        }

        function alternarVisao(tipo) {
            const secaoGraficos = document.getElementById('secaoGraficos');
            const secaoTabelas = document.getElementById('secaoTabelas');
            const btnGraficos = document.getElementById('btnGraficos');
            const btnTabelas = document.getElementById('btnTabelas');

            if (tipo === 'graficos') {
                secaoGraficos.classList.remove('hidden');
                secaoTabelas.classList.add('hidden');
                btnGraficos.classList.add('active');
                btnTabelas.classList.remove('active');
            } else {
                secaoGraficos.classList.add('hidden');
                secaoTabelas.classList.remove('hidden');
                btnTabelas.classList.add('active');
                btnGraficos.classList.remove('active');
            }
        }

        function aplicarFiltros() {
            const filtroTipo = document.getElementById('filtroTipo').value;
            const ordenacao = document.getElementById('ordenacao').value;
            bimestreAtual = document.getElementById('bimestreSelect').value;

            // Aplicar filtro
            if (filtroTipo === 'todas') {
                dadosFiltrados = [...dadosEscolas];
            } else if (filtroTipo === 'pei') {
                dadosFiltrados = dadosEscolas.filter(escola => escola.tipo === 'pei9h' || escola.tipo === 'pei7h');
            } else {
                dadosFiltrados = dadosEscolas.filter(escola => escola.tipo === filtroTipo);
            }

            // Aplicar ordena√ß√£o
            dadosFiltrados.sort((a, b) => {
                if (ordenacao === 'nome') return a.nome.localeCompare(b.nome);
                const dadosA = obterDadosBimestre(a, bimestreAtual);
                const dadosB = obterDadosBimestre(b, bimestreAtual);
                return dadosB[ordenacao] - dadosA[ordenacao];
            });

            // Recriar visualiza√ß√µes
            criarGraficos();
            criarTabelas();
        }

        function criarGraficos() {
            console.log('Iniciando cria√ß√£o dos gr√°ficos...');
            criarGraficoBarrasGeral();
            criarGraficoLinhaEvolucao();
            criarGraficoRadar();
            console.log('Criando gr√°ficos de dispers√£o...');
            criarGraficosDispersao();
            console.log('Criando matriz de correla√ß√£o...');
            criarMatrizCorrelacao();
            console.log('Criando an√°lise de grupos...');
            criarAnaliseGrupos();
            atualizarResumoEstatistico();
            console.log('Gr√°ficos criados com sucesso!');
        }

        function criarGraficoBarrasGeral() {
            const ctx = document.getElementById('graficoBarrasGeral').getContext('2d');
            
            if (window.graficoBarras) {
                window.graficoBarras.destroy();
            }

            const dados = dadosFiltrados.slice(0, 15); // Mostrar apenas top 15 para legibilidade
            
            if (bimestreAtual === 'evolucao') {
                // Mostrar evolu√ß√£o dos 3 bimestres
                const datasets = [
                    {
                        label: '1¬∫ Bimestre',
                        data: dados.map(e => obterDadosBimestre(e, 'bimestre1').superbi),
                        backgroundColor: '#EF4444',
                        borderColor: '#DC2626',
                        borderWidth: 1
                    },
                    {
                        label: '2¬∫ Bimestre',
                        data: dados.map(e => obterDadosBimestre(e, 'bimestre2').superbi),
                        backgroundColor: '#F59E0B',
                        borderColor: '#D97706',
                        borderWidth: 1
                    },
                    {
                        label: '3¬∫ Bimestre',
                        data: dados.map(e => obterDadosBimestre(e, 'bimestre3').superbi),
                        backgroundColor: '#10B981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }
                ];

                window.graficoBarras = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: dados.map(e => e.nome.replace('EE ', '').replace('PEI ', '')),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 7,
                                max: 10
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        }
                    }
                });
            } else {
                // Mostrar dados do bimestre espec√≠fico
                const nomeBimestre = bimestreAtual === 'bimestre1' ? '1¬∫ Bimestre' : 
                                   bimestreAtual === 'bimestre2' ? '2¬∫ Bimestre' : '3¬∫ Bimestre';
                
                window.graficoBarras = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: dados.map(e => e.nome.replace('EE ', '').replace('PEI ', '')),
                        datasets: [{
                            label: `Score Super BI - ${nomeBimestre}`,
                            data: dados.map(e => obterDadosBimestre(e, bimestreAtual).superbi),
                            backgroundColor: dados.map(e => 
                                e.tipo === 'pei9h' ? '#8B5CF6' : 
                                e.tipo === 'pei7h' ? '#A855F7' : '#3B82F6'
                            ),
                            borderColor: dados.map(e => 
                                e.tipo === 'pei9h' ? '#7C3AED' : 
                                e.tipo === 'pei7h' ? '#9333EA' : '#2563EB'
                            ),
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 7,
                                max: 10
                            },
                            x: {
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 45
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true
                            },
                            tooltip: {
                                callbacks: {
                                    afterLabel: function(context) {
                                        const escola = dados[context.dataIndex];
                                        return `Tipo: ${escola.tipo.toUpperCase()}`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }



        function criarGraficoLinhaEvolucao() {
            const ctx = document.getElementById('graficoLinhaEvolucao').getContext('2d');
            
            if (window.graficoLinha) {
                window.graficoLinha.destroy();
            }

            // Ordenar por 3¬∫ bimestre para pegar as top 5
            const top5 = [...dadosFiltrados].sort((a, b) => 
                obterDadosBimestre(b, 'bimestre3').superbi - obterDadosBimestre(a, 'bimestre3').superbi
            ).slice(0, 5);
            
            const bimestres = ['1¬∫ Bimestre', '2¬∫ Bimestre', '3¬∫ Bimestre'];

            const datasets = top5.map((escola, index) => {
                const cores = ['#EF4444', '#F59E0B', '#10B981', '#3B82F6', '#8B5CF6'];
                
                return {
                    label: escola.nome.replace('EE ', '').replace('PEI ', ''),
                    data: [
                        obterDadosBimestre(escola, 'bimestre1').superbi,
                        obterDadosBimestre(escola, 'bimestre2').superbi,
                        obterDadosBimestre(escola, 'bimestre3').superbi
                    ],
                    borderColor: cores[index],
                    backgroundColor: cores[index] + '20',
                    tension: 0.4,
                    fill: false,
                    pointRadius: 5,
                    pointHoverRadius: 7
                };
            });

            window.graficoLinha = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: bimestres,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 7,
                            max: 10
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function criarGraficoRadar() {
            const ctx = document.getElementById('graficoRadar').getContext('2d');
            
            if (window.graficoRadar) {
                window.graficoRadar.destroy();
            }

            // Usar bimestre atual ou 3¬∫ se for evolu√ß√£o
            const bimestreParaRadar = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
            
            // Criar datasets para todas as escolas por tipo
            const escolasRegulares = dadosFiltrados.filter(e => e.tipo === 'regular');
            const escolasPEI9h = dadosFiltrados.filter(e => e.tipo === 'pei9h');
            const escolasPEI7h = dadosFiltrados.filter(e => e.tipo === 'pei7h');

            const datasets = [];

            // Calcular m√©dias por tipo
            if (escolasRegulares.length > 0) {
                const mediaRegular = calcularMediaPorTipo(escolasRegulares, bimestreParaRadar);
                datasets.push({
                    label: 'M√©dia Escolas Regulares',
                    data: [mediaRegular.superbi, mediaRegular.frequencia/10, mediaRegular.alura, mediaRegular.khan, mediaRegular.provaPaulista, mediaRegular.tarefas],
                    borderColor: '#3B82F6',
                    backgroundColor: '#3B82F620',
                    pointBackgroundColor: '#3B82F6',
                    pointBorderColor: '#3B82F6',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#3B82F6'
                });
            }

            if (escolasPEI9h.length > 0) {
                const mediaPEI9h = calcularMediaPorTipo(escolasPEI9h, bimestreParaRadar);
                datasets.push({
                    label: 'M√©dia PEI 9 horas',
                    data: [mediaPEI9h.superbi, mediaPEI9h.frequencia/10, mediaPEI9h.alura, mediaPEI9h.khan, mediaPEI9h.provaPaulista, mediaPEI9h.tarefas],
                    borderColor: '#8B5CF6',
                    backgroundColor: '#8B5CF620',
                    pointBackgroundColor: '#8B5CF6',
                    pointBorderColor: '#8B5CF6',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#8B5CF6'
                });
            }

            if (escolasPEI7h.length > 0) {
                const mediaPEI7h = calcularMediaPorTipo(escolasPEI7h, bimestreParaRadar);
                datasets.push({
                    label: 'M√©dia PEI 7 horas',
                    data: [mediaPEI7h.superbi, mediaPEI7h.frequencia/10, mediaPEI7h.alura, mediaPEI7h.khan, mediaPEI7h.provaPaulista, mediaPEI7h.tarefas],
                    borderColor: '#A855F7',
                    backgroundColor: '#A855F720',
                    pointBackgroundColor: '#A855F7',
                    pointBorderColor: '#A855F7',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#A855F7'
                });
            }

            window.graficoRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Super BI', 'Frequ√™ncia', 'ALURA', 'KHAN', 'Prova Paulista', 'Tarefas'],
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function criarTabelas() {
            criarTabelaPrincipal();
            criarRankings();
        }

        function criarTabelaPrincipal() {
            const tbody = document.getElementById('corpoTabela');
            tbody.innerHTML = '';

            dadosFiltrados.forEach(escola => {
                const tr = document.createElement('tr');
                tr.className = 'border-b hover:bg-gray-50';
                
                const tipoClass = escola.tipo === 'pei9h' ? 'text-purple-600 font-semibold' : 
                                 escola.tipo === 'pei7h' ? 'text-pink-600 font-semibold' : 'text-blue-600';
                
                // Usar dados do bimestre selecionado ou do 3¬∫ bimestre se for evolu√ß√£o
                const bimestreParaTabela = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
                const dados = obterDadosBimestre(escola, bimestreParaTabela);
                
                const scoreBg = dados.superbi >= 9 ? 'bg-green-100 text-green-800' : 
                               dados.superbi >= 8.5 ? 'bg-yellow-100 text-yellow-800' : 
                               'bg-red-100 text-red-800';

                // Calcular evolu√ß√£o do 1¬∫ ao 3¬∫ bimestre
                const evolucao = obterDadosBimestre(escola, 'bimestre3').superbi - obterDadosBimestre(escola, 'bimestre1').superbi;
                const evolucaoClass = evolucao >= 0.5 ? 'text-green-600' : evolucao >= 0 ? 'text-yellow-600' : 'text-red-600';
                const evolucaoIcon = evolucao >= 0.5 ? 'üìà' : evolucao >= 0 ? '‚û°Ô∏è' : 'üìâ';

                tr.innerHTML = `
                    <td class="px-4 py-3 font-medium">${escola.nome}</td>
                    <td class="px-4 py-3 ${tipoClass}">${
                        escola.tipo === 'pei9h' ? 'PEI 9H' : 
                        escola.tipo === 'pei7h' ? 'PEI 7H' : 'REGULAR'
                    }</td>
                    <td class="px-4 py-3 text-center">
                        <span class="px-2 py-1 rounded-full text-sm font-medium ${scoreBg}">
                            ${dados.superbi.toFixed(2)}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center">${dados.frequencia.toFixed(1)}%</td>
                    <td class="px-4 py-3 text-center">${dados.alura.toFixed(1)}</td>
                    <td class="px-4 py-3 text-center">${dados.khan.toFixed(1)}</td>
                    <td class="px-4 py-3 text-center">${dados.provaPaulista.toFixed(1)}</td>
                    <td class="px-4 py-3 text-center">${dados.tarefas.toFixed(1)}</td>
                    <td class="px-4 py-3 text-center">
                        <span class="font-semibold ${evolucaoClass}">
                            ${evolucaoIcon} ${evolucao >= 0 ? '+' : ''}${evolucao.toFixed(2)}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function criarRankings() {
            const bimestreParaRanking = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
            
            // Ranking Super BI
            const topSuperBI = [...dadosFiltrados].sort((a, b) => 
                obterDadosBimestre(b, bimestreParaRanking).superbi - obterDadosBimestre(a, bimestreParaRanking).superbi
            ).slice(0, 10);
            const rankingSuperBI = document.getElementById('rankingSuperBI');
            rankingSuperBI.innerHTML = topSuperBI.map((escola, index) => `
                <div class="flex items-center justify-between py-2 px-3 ${index < 3 ? 'bg-yellow-50' : ''}">
                    <div class="flex items-center">
                        <span class="w-6 h-6 rounded-full ${index < 3 ? 'bg-yellow-400' : 'bg-gray-200'} flex items-center justify-center text-sm font-bold mr-3">
                            ${index + 1}
                        </span>
                        <span class="text-sm font-medium">${escola.nome.replace('EE ', '').replace('PEI ', '')}</span>
                    </div>
                    <span class="font-bold text-blue-600">${obterDadosBimestre(escola, bimestreParaRanking).superbi.toFixed(2)}</span>
                </div>
            `).join('');

            // Ranking Frequ√™ncia
            const topFrequencia = [...dadosFiltrados].sort((a, b) => 
                obterDadosBimestre(b, bimestreParaRanking).frequencia - obterDadosBimestre(a, bimestreParaRanking).frequencia
            ).slice(0, 10);
            const rankingFrequencia = document.getElementById('rankingFrequencia');
            rankingFrequencia.innerHTML = topFrequencia.map((escola, index) => `
                <div class="flex items-center justify-between py-2 px-3 ${index < 3 ? 'bg-green-50' : ''}">
                    <div class="flex items-center">
                        <span class="w-6 h-6 rounded-full ${index < 3 ? 'bg-green-400' : 'bg-gray-200'} flex items-center justify-center text-sm font-bold mr-3">
                            ${index + 1}
                        </span>
                        <span class="text-sm font-medium">${escola.nome.replace('EE ', '').replace('PEI ', '')}</span>
                    </div>
                    <span class="font-bold text-green-600">${obterDadosBimestre(escola, bimestreParaRanking).frequencia.toFixed(1)}%</span>
                </div>
            `).join('');
        }

        // Fun√ß√£o auxiliar para calcular m√©dia por tipo
        function calcularMediaPorTipo(escolas, bimestre) {
            const total = escolas.length;
            const soma = escolas.reduce((acc, escola) => {
                const dados = obterDadosBimestre(escola, bimestre);
                return {
                    superbi: acc.superbi + dados.superbi,
                    frequencia: acc.frequencia + dados.frequencia,
                    alura: acc.alura + dados.alura,
                    khan: acc.khan + dados.khan,
                    provaPaulista: acc.provaPaulista + dados.provaPaulista,
                    tarefas: acc.tarefas + dados.tarefas
                };
            }, { superbi: 0, frequencia: 0, alura: 0, khan: 0, provaPaulista: 0, tarefas: 0 });

            return {
                superbi: soma.superbi / total,
                frequencia: soma.frequencia / total,
                alura: soma.alura / total,
                khan: soma.khan / total,
                provaPaulista: soma.provaPaulista / total,
                tarefas: soma.tarefas / total
            };
        }

        // Fun√ß√£o para calcular correla√ß√£o
        function calcularCorrelacao(array1, array2) {
            const n = array1.length;
            const sum1 = array1.reduce((a, b) => a + b, 0);
            const sum2 = array2.reduce((a, b) => a + b, 0);
            const sum1Sq = array1.reduce((a, b) => a + b * b, 0);
            const sum2Sq = array2.reduce((a, b) => a + b * b, 0);
            const pSum = array1.map((x, i) => x * array2[i]).reduce((a, b) => a + b, 0);
            
            const num = pSum - (sum1 * sum2 / n);
            const den = Math.sqrt((sum1Sq - sum1 * sum1 / n) * (sum2Sq - sum2 * sum2 / n));
            
            return den === 0 ? 0 : num / den;
        }

        function criarGraficosDispersao() {
            const bimestreParaDispersao = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
            
            // Verificar se os elementos existem antes de criar os gr√°ficos
            if (document.getElementById('graficoDispersaoAlura')) {
                criarGraficoDispersao('graficoDispersaoAlura', 'alura', 'ALURA', bimestreParaDispersao);
            }
            if (document.getElementById('graficoDispersaoKhan')) {
                criarGraficoDispersao('graficoDispersaoKhan', 'khan', 'KHAN', bimestreParaDispersao);
            }
            if (document.getElementById('graficoDispersaoFrequencia')) {
                criarGraficoDispersao('graficoDispersaoFrequencia', 'frequencia', 'Frequ√™ncia', bimestreParaDispersao);
            }
            if (document.getElementById('graficoDispersaoProva')) {
                criarGraficoDispersao('graficoDispersaoProva', 'provaPaulista', 'Prova Paulista', bimestreParaDispersao);
            }
        }

        function criarGraficoDispersao(canvasId, propriedade, titulo, bimestre) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error(`Canvas ${canvasId} n√£o encontrado`);
                return;
            }

            const ctx = canvas.getContext('2d');
            
            if (window[canvasId]) {
                window[canvasId].destroy();
            }

            const dadosDispersao = dadosFiltrados.map(escola => {
                const dados = obterDadosBimestre(escola, bimestre);
                return {
                    x: dados[propriedade],
                    y: dados.superbi,
                    escola: escola.nome,
                    tipo: escola.tipo
                };
            });

            const datasets = [
                {
                    label: 'Escolas Regulares',
                    data: dadosDispersao.filter(d => d.tipo === 'regular'),
                    backgroundColor: '#3B82F6',
                    borderColor: '#2563EB',
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'PEI 9 horas',
                    data: dadosDispersao.filter(d => d.tipo === 'pei9h'),
                    backgroundColor: '#8B5CF6',
                    borderColor: '#7C3AED',
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'PEI 7 horas',
                    data: dadosDispersao.filter(d => d.tipo === 'pei7h'),
                    backgroundColor: '#A855F7',
                    borderColor: '#9333EA',
                    pointRadius: 6,
                    pointHoverRadius: 8
                }
            ];

            window[canvasId] = new Chart(ctx, {
                type: 'scatter',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: titulo + (propriedade === 'frequencia' ? ' (%)' : ' (Score)')
                            },
                            min: propriedade === 'frequencia' ? 80 : 6,
                            max: propriedade === 'frequencia' ? 100 : 10
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Super BI (Score)'
                            },
                            min: 7,
                            max: 10
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.escola;
                                },
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `${titulo}: ${point.x.toFixed(1)}${propriedade === 'frequencia' ? '%' : ''}`,
                                        `Super BI: ${point.y.toFixed(2)}`,
                                        `Tipo: ${point.tipo === 'regular' ? 'Regular' : point.tipo === 'pei9h' ? 'PEI 9h' : 'PEI 7h'}`
                                    ];
                                }
                            }
                        }
                    }
                }
            });
        }

        function criarMatrizCorrelacao() {
            const tbody = document.getElementById('corpoTabelaCorrelacao');
            if (!tbody) {
                console.error('Elemento corpoTabelaCorrelacao n√£o encontrado');
                return;
            }

            const bimestreParaCorrelacao = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
            
            const indicadores = ['superbi', 'frequencia', 'alura', 'khan', 'provaPaulista', 'tarefas'];
            const nomes = ['Super BI', 'Frequ√™ncia', 'ALURA', 'KHAN', 'P. Paulista', 'Tarefas'];
            
            const dados = {};
            indicadores.forEach(ind => {
                dados[ind] = dadosFiltrados.map(escola => obterDadosBimestre(escola, bimestreParaCorrelacao)[ind]);
            });

            tbody.innerHTML = '';

            indicadores.forEach((ind1, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="border px-4 py-2 font-medium">${nomes[i]}</td>`;
                
                indicadores.forEach(ind2 => {
                    const correlacao = calcularCorrelacao(dados[ind1], dados[ind2]);
                    const corClass = Math.abs(correlacao) >= 0.7 ? 'bg-green-100 text-green-800' :
                                   Math.abs(correlacao) >= 0.5 ? 'bg-yellow-100 text-yellow-800' :
                                   'bg-red-100 text-red-800';
                    
                    tr.innerHTML += `<td class="border px-4 py-2 text-center ${corClass}">${correlacao.toFixed(3)}</td>`;
                });
                
                tbody.appendChild(tr);
            });
        }

        function criarAnaliseGrupos() {
            const container = document.getElementById('analiseGrupos');
            if (!container) {
                console.error('Elemento analiseGrupos n√£o encontrado');
                return;
            }

            const bimestreParaGrupos = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
            
            const grupos = {
                'Alto Desempenho': dadosFiltrados.filter(e => obterDadosBimestre(e, bimestreParaGrupos).superbi >= 9.0),
                'M√©dio Desempenho': dadosFiltrados.filter(e => {
                    const score = obterDadosBimestre(e, bimestreParaGrupos).superbi;
                    return score >= 8.0 && score < 9.0;
                }),
                'Baixo Desempenho': dadosFiltrados.filter(e => obterDadosBimestre(e, bimestreParaGrupos).superbi < 8.0)
            };

            container.innerHTML = '';

            Object.entries(grupos).forEach(([nome, escolas], index) => {
                if (escolas.length === 0) return;

                const cores = ['bg-green-50 border-green-200', 'bg-yellow-50 border-yellow-200', 'bg-red-50 border-red-200'];
                const textCores = ['text-green-800', 'text-yellow-800', 'text-red-800'];

                const media = calcularMediaPorTipo(escolas, bimestreParaGrupos);
                
                const div = document.createElement('div');
                div.className = `p-4 rounded-lg border-2 ${cores[index]}`;
                div.innerHTML = `
                    <h4 class="font-bold text-lg ${textCores[index]} mb-2">${nome}</h4>
                    <p class="text-sm mb-2">${escolas.length} escolas</p>
                    <div class="space-y-1 text-xs">
                        <div>Super BI: ${media.superbi.toFixed(2)}</div>
                        <div>Frequ√™ncia: ${media.frequencia.toFixed(1)}%</div>
                        <div>ALURA: ${media.alura.toFixed(1)}</div>
                        <div>KHAN: ${media.khan.toFixed(1)}</div>
                    </div>
                    <div class="mt-2 text-xs text-gray-600">
                        ${escolas.map(e => e.nome.replace('EE ', '').replace('PEI ', '')).join(', ')}
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function atualizarResumoEstatistico() {
            const bimestreParaEstatistica = bimestreAtual === 'evolucao' ? 'bimestre3' : bimestreAtual;
            
            const mediaGeral = dadosFiltrados.reduce((acc, escola) => 
                acc + obterDadosBimestre(escola, bimestreParaEstatistica).superbi, 0) / dadosFiltrados.length;
            const melhorEscola = Math.max(...dadosFiltrados.map(e => 
                obterDadosBimestre(e, bimestreParaEstatistica).superbi));
            const mediaFrequencia = dadosFiltrados.reduce((acc, escola) => 
                acc + obterDadosBimestre(escola, bimestreParaEstatistica).frequencia, 0) / dadosFiltrados.length;
            const escolasPEI = dadosFiltrados.filter(e => e.tipo === 'pei9h' || e.tipo === 'pei7h').length;

            document.getElementById('mediaGeral').textContent = mediaGeral.toFixed(2);
            document.getElementById('melhorEscola').textContent = melhorEscola.toFixed(2);
            document.getElementById('mediaFrequencia').textContent = mediaFrequencia.toFixed(1) + '%';
            document.getElementById('escolasPEI').textContent = escolasPEI;
        }
    </script>
</body>
</html>